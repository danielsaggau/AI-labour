set more offpause off capture log close* log using ../log/census-wg-prep-`1'.log, text replacelog using census-wg-prep-`1'.log, text replace/*     For years 1960-2008 :        Prepare Census data for wage regressions / partial r-squared calculations            (1) Keep only observations with valid occupations                (2) Keep only wage observations (non self employed, non military)                (3) Define age categories, interaction terms            Melanie Wasserman, 2010    */clearset mem 8g* use ../dta/microwage`1'_extuse microwage`1'_extrename yr yeartab year, summ(flag_occmissing)drop if flag_occmissingdrop flag_occmissingif `1'==1960 summ occif `1'==1970 summ occif `1'>=1980 summ occ1990ddassert ln_hrwage==. if ln_wkwage==.assert ln_wkwage==. if ln_hrwage==.assert ln_hrwage!=. if ln_wkwage!=.assert ln_wkwage!=. if ln_hrwage!=.gen byte wageobs=ln_hrwage!=./* ethinicity */gen hisp=1 if hispand!=0 & hispand!=900replace hisp=0 if hispand==0/* create age groups */gen agecat3=.replace agecat3=1 if age>=17 & age<=30replace agecat3=2 if age>=31 & age<=55replace agecat3=3 if age>=56 & age<=65assert agecat3!=./* create education groups */gen edhsd= (ed_0==1 | ed_1_4==1 | ed_5_8==1 | ed_9==1 | ed_10==1 | ed_11==1)gen edhsg=  ed_12==1gen edsmc=  ed_13_15==1gen edclg=  ed_16==1gen edgtc=  ed_17up==1assert edhsd + edhsg + edsmc + edclg + edgtc==1gen edyrs2=(edyrs^2)/100#delimit;/* experience education interactions */drop exp2 exp3 exp4;rename exp exp1;gen exp2 = (exp1^2)/100;gen exp3 = (exp1^3)/1000;gen exp4 = (exp1^4)/10000;gen e1edhsd = exp1*edhsd;gen e1edsmc = exp1*edsmc;gen e1edclg = exp1*edclg;gen e1edgtc = exp1*edgtc;gen e2edhsd = exp2*edhsd;gen e2edsmc = exp2*edsmc;gen e2edclg = exp2*edclg;gen e2edgtc = exp2*edgtc;gen e3edhsd = exp3*edhsd;gen e3edsmc = exp3*edsmc;gen e3edclg = exp3*edclg;gen e3edgtc = exp3*edgtc;gen e4edhsd = exp4*edhsd;gen e4edsmc = exp4*edsmc;gen e4edclg = exp4*edclg;gen e4edgtc = exp4*edgtc;/* Gender interactions with experience, education */gen fexp1 = female*exp1;gen fexp2 = female*exp2;gen fexp3 = female*exp3;gen fexp4 = female*exp4;gen fedhsd = female*edhsd;gen fedsmc = female*edsmc;gen fedclg = female*edclg;gen fedgtc = female*edgtc;    gen f_edyrs=female*edyrs;gen f_edyrs2=female*edyrs2;tab year, summ(perwt);egen sumwt=sum(perwt),by(year);/* Drop all observations without wage data */drop if !wageobs;* save ../dta/microwage`1'_ext_reg, replace;save microwage`1'_ext_reg, replace;